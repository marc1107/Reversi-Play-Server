@import utils.BoardHelper
@import de.htwg.model.fieldComponent.FieldInterface
@import de.htwg.model.Stone

@(field: FieldInterface, playerState: Stone)

@main("Welcome to Reversi") {
    @background()
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/game.css")">
    <audio id="click-sound-click1" src="@routes.Assets.versioned("sounds/click1.mp3")" preload="auto"></audio>
    <audio id="click-sound-click2" src="@routes.Assets.versioned("sounds/click2.mp3")" preload="auto"></audio>
    <audio id="click-sound-click3" src="@routes.Assets.versioned("sounds/laser1.mp3")" preload="auto"></audio>
    <audio id="error-sound1" src="@routes.Assets.versioned("sounds/error1.mp3")" preload="auto"></audio>

    <div class="scroll-container">
        <div class="content">
            <div class="header-container">
                <h1>Reversi</h1>
            </div>
            <div id="widthDisplay"></div>

            <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        // Initialisierung der Variablen
                        const playerInfo = document.querySelector(".playerinfo");
                        const dragPiece = document.getElementById("drag-piece");
                        let isDragging = false; // Status, ob das Dragging aktiv ist oder nicht

                        // Funktion zum Anzeigen des Zylinders und Starten des Dragging
                        playerInfo.addEventListener("mousedown", function (event) {
                            event.preventDefault(); // Verhindert das Markieren von Inhalten
                            isDragging = true; // Aktiviert das Dragging

                            // Setze die Farbe des Zylinders basierend auf playerState
                            if (playerInfo.querySelector(".black")) {
                                dragPiece.style.backgroundColor = "black";
                            } else {
                                dragPiece.style.backgroundColor = "white";
                            }

                            // Zylinder anzeigen und auf den Mauszeiger positionieren
                            dragPiece.style.display = "block";
                            dragPiece.style.position = "fixed";
                            dragPiece.style.left = `${event.clientX}px`;
                            dragPiece.style.top = `${event.clientY}px`;

                            // Starte das Verfolgen der Mausbewegungen
                            document.addEventListener("mousemove", movePiece);
                        });

                        // Mausbewegungsfunktion, um den Zylinder der Maus folgen zu lassen
                        function movePiece(event) {
                            if (isDragging) {
                                dragPiece.style.left = `${event.clientX}px`;
                                dragPiece.style.top = `${event.clientY}px`;
                            }
                        }

                        // Versteckt den Zylinder und beendet das Dragging, wenn die Maustaste losgelassen wird
                        document.addEventListener("mouseup", function () {
                            if (isDragging) {
                                dragPiece.style.display = "none";
                                document.removeEventListener("mousemove", movePiece);
                                isDragging = false; // Deaktiviert das Dragging
                            }
                        });

                        // Hole alle <td>-Elemente und füge den mouseup-Event-Listener hinzu
                        const cells = document.querySelectorAll("td[data-row][data-cell]");
                        cells.forEach(cell => {
                            cell.addEventListener("mouseup", function () {
                                // Wenn gerade gezogen wird (Zylinder sichtbar), rufe makeMove auf
                                if (isDragging) {
                                    const row = cell.getAttribute("data-row");
                                    const col = cell.getAttribute("data-cell");
                                    makeMove(row, col);
                                }
                            });
                        });
                    });
            </script>

            @playerturn(playerState)
            <div id="drag-piece" class="draggable-piece"></div>

            @Html(BoardHelper.boardToHtml(field))
            @helper.form(action = routes.ReversiController.makeMoveSubmit()) {
                <div class="col-12 text-center mt-2">
                    <label for="sound-select">Sound auswählen:</label>
                    <select id="sound-select" class="sound-select" onchange="changeClickSound()">
                        <option value="click1">Click 1</option>
                        <option value="click2">Click 2</option>
                        <option value="click3">Laser 1</option>
                    </select>
                </div>
            }
            <div class="gamerules-small">
                <a class="abutton .responsive-button" href="@routes.ReversiController.rules()">Rules</a>
            </div>
        </div>
        <div class="gamerules">
            <a class="abutton" href="@routes.ReversiController.rules()">View Game Rules</a>
        </div>
    </div>
}